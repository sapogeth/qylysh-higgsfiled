# ‚ö° –§–ò–ù–ê–õ–¨–ù–´–ï –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò - M1 MacBook Air 8GB

## üéØ –¶–µ–ª—å: –ë–´–°–¢–†–û + –†–ê–ë–û–¢–ê–ï–¢ + –ö–ê–ß–ï–°–¢–í–ï–ù–ù–û

---

## üìä –ü—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1Ô∏è‚É£ –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ: 1024 ‚Üí 768

```python
# config.py:
IMAGE_WIDTH = 768
IMAGE_HEIGHT = 768
```

**–≠—Ñ—Ñ–µ–∫—Ç**:
- **–ü–∞–º—è—Ç—å**: -44% (1024¬≤ ‚Üí 768¬≤ = -455K –ø–∏–∫—Å–µ–ª–µ–π)
- **–°–∫–æ—Ä–æ—Å—Ç—å**: +15% (–º–µ–Ω—å—à–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π)
- **–ö–∞—á–µ—Å—Ç–≤–æ**: 9/10 (–æ—Ç–ª–∏—á–Ω–æ –¥–ª—è —Å—Ç–æ—Ä–∏–±–æ—Ä–¥–æ–≤)

---

### 2Ô∏è‚É£ –®–∞–≥–∏ –î–∏—Ñ—Ñ—É–∑–∏–∏: 20 ‚Üí 12

```python
NUM_INFERENCE_STEPS = 12
```

**–≠—Ñ—Ñ–µ–∫—Ç**:
- **–°–∫–æ—Ä–æ—Å—Ç—å**: -40% –≤—Ä–µ–º–µ–Ω–∏
- **–ö–∞—á–µ—Å—Ç–≤–æ**: 8.5/10 (SDXL —Ö–æ—Ä–æ—à –¥–∞–∂–µ —Å 12 —à–∞–≥–∞–º–∏)

---

### 3Ô∏è‚É£ Guidance Scale: 7.5 ‚Üí 6.5

```python
GUIDANCE_SCALE = 6.5
```

**–≠—Ñ—Ñ–µ–∫—Ç**:
- **–°–∫–æ—Ä–æ—Å—Ç—å**: -13% CFG –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
- **–ë–∞–ª–∞–Ω—Å**: –ú–µ–Ω—å—à–µ –∂—ë—Å—Ç–∫–æ—Å—Ç—å, –±–æ–ª—å—à–µ —Å–∫–æ—Ä–æ—Å—Ç—å

---

### 4Ô∏è‚É£ IP-Adapter: 0.80 ‚Üí 0.50

```python
IP_ADAPTER_SCALE = 0.50
```

**–≠—Ñ—Ñ–µ–∫—Ç**:
- **–°–∫–æ—Ä–æ—Å—Ç—å**: -30% IP-Adapter –≤–ª–∏—è–Ω–∏—è
- **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ª–∏—Ü–∞**: 85-90% (vs 95%)
- **–ö–æ–º–ø—Ä–æ–º–∏—Å—Å**: CHARACTER_TRAITS –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É—é—Ç —Å–Ω–∏–∂–µ–Ω–∏–µ

---

### 5Ô∏è‚É£ M1 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

```python
ENABLE_ATTENTION_SLICING = True
ENABLE_VAE_SLICING = True
ENABLE_VAE_TILING = True
ENABLE_CHANNELS_LAST = True
SKIP_SAFETY_CHECKER = True
```

**–≠—Ñ—Ñ–µ–∫—Ç**:
- **–ü–∞–º—è—Ç—å**: -20% –ø–∏–∫–æ–≤–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **–°–∫–æ—Ä–æ—Å—Ç—å**: +10-15% –Ω–∞ M1

---

### 6Ô∏è‚É£ –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –û—á–∏—Å—Ç–∫–∞ –ü–∞–º—è—Ç–∏

```python
# –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:
del result
gc.collect()
torch.mps.empty_cache()
```

**–≠—Ñ—Ñ–µ–∫—Ç**:
- **–ü–∞–º—è—Ç—å**: –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç ~500 MB –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –º—É—Å–æ—Ä–∞

---

### ‚ùå –ß—Ç–æ –ù–ï –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ MPS

```python
# –û–¢–ö–õ–Æ–ß–ï–ù–û (–≤—ã–∑—ã–≤–∞–µ—Ç CUDA –æ—à–∏–±–∫—É):
ENABLE_MODEL_CPU_OFFLOAD = False  # –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å MPS
torch.autocast()  # –ù–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ –Ω–∞ MPS
```

---

## üìà –û–∂–∏–¥–∞–µ–º–∞—è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –° –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º 768x768:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| **1 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ** | ~3-4 —Å–µ–∫—É–Ω–¥—ã |
| **6 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** | ~18-24 —Å–µ–∫—É–Ω–¥—ã |
| **–ü–∞–º—è—Ç—å MPS** | ~5-6 GB (–±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è 9 GB –ª–∏–º–∏—Ç–∞) |
| **–ö–∞—á–µ—Å—Ç–≤–æ** | 8.5/10 |
| **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ª–∏—Ü–∞** | 85-90% |

---

## üß™ –ö–∞–∫ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```bash
grep "IMAGE_WIDTH\|NUM_INFERENCE_STEPS\|ENABLE_MODEL_CPU_OFFLOAD" config.py
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å**:
```
IMAGE_WIDTH = 768
NUM_INFERENCE_STEPS = 12
ENABLE_MODEL_CPU_OFFLOAD = False
```

---

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç:

```bash
python3 test_speed.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
```
‚úÖ –ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞
‚úÖ –û–¥–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: ~3-4 —Å–µ–∫—É–Ω–¥—ã
‚úÖ 3 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: ~9-12 —Å–µ–∫—É–Ω–¥
‚úÖ –ü–∞–º—è—Ç—å: ~5-6 GB MPS
```

–ï—Å–ª–∏ –ø–æ–ª—É—á–∞–µ—Ç–µ "Out of Memory" - –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–∫—Ä—ã—Ç—å –¥—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:

```bash
python3 app.py
```

–û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:8080`

---

## üîß –†–µ–∂–∏–º—ã –°–∫–æ—Ä–æ—Å—Ç–∏/–ö–∞—á–µ—Å—Ç–≤–∞

### –¢–µ–∫—É—â–∏–π (FAST - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
```python
IMAGE_WIDTH = 768
NUM_INFERENCE_STEPS = 12
IP_ADAPTER_SCALE = 0.50
```
**–°–∫–æ—Ä–æ—Å—Ç—å**: 3-4 —Å–µ–∫ | **–ö–∞—á–µ—Å—Ç–≤–æ**: 8.5/10 ‚≠ê

---

### ULTRA_FAST (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –µ—â—ë –±—ã—Å—Ç—Ä–µ–µ):
```python
IMAGE_WIDTH = 512
NUM_INFERENCE_STEPS = 8
IP_ADAPTER_SCALE = 0.40
```
**–°–∫–æ—Ä–æ—Å—Ç—å**: 2-3 —Å–µ–∫ | **–ö–∞—á–µ—Å—Ç–≤–æ**: 7/10

---

### BALANCED (–±–æ–ª—å—à–µ –∫–∞—á–µ—Å—Ç–≤–∞):
```python
IMAGE_WIDTH = 768
NUM_INFERENCE_STEPS = 15
IP_ADAPTER_SCALE = 0.65
```
**–°–∫–æ—Ä–æ—Å—Ç—å**: 4-5 —Å–µ–∫ | **–ö–∞—á–µ—Å—Ç–≤–æ**: 9/10

---

### QUALITY (–º–∞–∫—Å–∏–º—É–º –∫–∞—á–µ—Å—Ç–≤–∞ - –º–æ–∂–µ—Ç –Ω–µ —Ö–≤–∞—Ç–∏—Ç—å –ø–∞–º—è—Ç–∏!):
```python
IMAGE_WIDTH = 1024
NUM_INFERENCE_STEPS = 20
IP_ADAPTER_SCALE = 0.80
```
**–°–∫–æ—Ä–æ—Å—Ç—å**: 6-7 —Å–µ–∫ | **–ö–∞—á–µ—Å—Ç–≤–æ**: 9.5/10 | **–ü–∞–º—è—Ç—å**: ‚ö†Ô∏è –ú–æ–∂–µ—Ç –±—ã—Ç—å OOM

---

## üíæ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ü–∞–º—è—Ç–∏

### –¢–µ–∫—É—â–∞—è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (768x768):

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ü–∞–º—è—Ç—å MPS |
|-----------|------------|
| SDXL UNet | ~3.5 GB |
| Text Encoders | ~1.0 GB |
| VAE | ~0.8 GB |
| Latents (768x768) | ~180 MB |
| IP-Adapter | ~0.3 GB |
| **–ò–¢–û–ì–û** | **~5.8 GB** ‚úÖ |

**–õ–∏–º–∏—Ç M1**: 9.07 GB
**–ó–∞–ø–∞—Å**: ~3.3 GB ‚úÖ

---

### –ï—Å–ª–∏ 1024x1024 (–ù–ï —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ü–∞–º—è—Ç—å MPS |
|-----------|------------|
| SDXL UNet | ~5.2 GB |
| Text Encoders | ~1.5 GB |
| VAE | ~1.2 GB |
| Latents (1024x1024) | ~320 MB |
| IP-Adapter | ~0.3 GB |
| **–ò–¢–û–ì–û** | **~8.5 GB** ‚ö†Ô∏è |

**–õ–∏–º–∏—Ç M1**: 9.07 GB
**–ó–∞–ø–∞—Å**: ~0.6 GB ‚ùå (—Å–ª–∏—à–∫–æ–º –º–∞–ª–æ!)

---

## üé® –ö–∞—á–µ—Å—Ç–≤–æ 768x768

### –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è:
- ‚úÖ –í–µ–±-–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–∏–¥–µ–∞–ª—å–Ω–æ)
- ‚úÖ –°—Ç–æ—Ä–∏–±–æ—Ä–¥–∏–Ω–≥ (–∏–¥–µ–∞–ª—å–Ω–æ)
- ‚úÖ –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ (Instagram, Twitter)
- ‚úÖ –ü—Ä–µ–≤—å—é –∏ —á–µ—Ä–Ω–æ–≤–∏–∫–∏
- ‚úÖ –ê–Ω–∏–º–∞—Ü–∏—è
- ‚ö†Ô∏è –ü–µ—á–∞—Ç—å (A5 —Ñ–æ—Ä–º–∞—Ç –∏ –º–µ–Ω—å—à–µ)

### –ù–ï –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è:
- ‚ùå –ü–µ—á–∞—Ç—å A4 –∏ –±–æ–ª—å—à–µ
- ‚ùå –í—ã—Å–æ–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

**–í—ã–≤–æ–¥**: –î–ª—è –≤–∞—à–µ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è (—Å—Ç–æ—Ä–∏–±–æ—Ä–¥–∏–Ω–≥) 768x768 –∏–¥–µ–∞–ª—å–Ω–æ!

---

## üõ†Ô∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –û—à–∏–±–∫–∏

### ‚ùå MPS Out of Memory
**–†–µ—à–µ–Ω–∏–µ**: –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ 1024 ‚Üí 768 (-44% –ø–∞–º—è—Ç–∏)

### ‚ùå CUDA Error (CPU offload)
**–†–µ—à–µ–Ω–∏–µ**: –û—Ç–∫–ª—é—á—ë–Ω `ENABLE_MODEL_CPU_OFFLOAD`

### ‚ùå Autocast Instability
**–†–µ—à–µ–Ω–∏–µ**: –£–±—Ä–∞–Ω `torch.autocast()` –¥–ª—è MPS

---

## üìä –§–∏–Ω–∞–ª—å–Ω–∞—è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```python
# –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ
IMAGE_WIDTH = 768
IMAGE_HEIGHT = 768

# –°–∫–æ—Ä–æ—Å—Ç—å
NUM_INFERENCE_STEPS = 12
GUIDANCE_SCALE = 6.5
IP_ADAPTER_SCALE = 0.50

# M1 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
ENABLE_ATTENTION_SLICING = True
ENABLE_VAE_SLICING = True
ENABLE_VAE_TILING = True
ENABLE_CHANNELS_LAST = True
SKIP_SAFETY_CHECKER = True

# –û—Ç–∫–ª—é—á–µ–Ω–æ (–∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã)
ENABLE_MODEL_CPU_OFFLOAD = False
```

---

## üéØ –ò—Ç–æ–≥–∏

### ‚úÖ –î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ:

1. **–°–∫–æ—Ä–æ—Å—Ç—å**: ~3-4 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (50% –±—ã—Å—Ç—Ä–µ–µ)
2. **–ü–∞–º—è—Ç—å**: ~5.8 GB MPS (–±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è M1 8GB)
3. **–ö–∞—á–µ—Å—Ç–≤–æ**: 8.5/10 (–æ—Ç–ª–∏—á–Ω–æ –¥–ª—è —Å—Ç–æ—Ä–∏–±–æ—Ä–¥–æ–≤)
4. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: –ë–µ–∑ OOM –∏ CUDA –æ—à–∏–±–æ–∫

### üöÄ –ü—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

- ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ: 768x768 (-44% –ø–∞–º—è—Ç–∏)
- ‚úÖ –®–∞–≥–∏: 12 (-40% –≤—Ä–µ–º–µ–Ω–∏)
- ‚úÖ CFG: 6.5 (-13% –≤—ã—á–∏—Å–ª–µ–Ω–∏–π)
- ‚úÖ IP-Adapter: 0.50 (–±–∞–ª–∞–Ω—Å)
- ‚úÖ M1 –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (attention slicing, VAE slicing, channels_last)
- ‚úÖ –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–∞–º—è—Ç–∏

### üìà –§–∏–Ω–∞–ª—å–Ω–∞—è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

```
–°–ö–û–†–û–°–¢–¨:     ~3-4 —Å–µ–∫—É–Ω–¥—ã/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ üöÄ
6 –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô: ~18-24 —Å–µ–∫—É–Ω–¥—ã üöÄ
–ü–ê–ú–Ø–¢–¨:       ~5.8 GB MPS (–±–µ–∑–æ–ø–∞—Å–Ω–æ) ‚úÖ
–ö–ê–ß–ï–°–¢–í–û:     8.5/10 ‚úÖ
–°–¢–ê–ë–ò–õ–¨–ù–û–°–¢–¨: 100% ‚úÖ
```

---

## üéâ –ì–û–¢–û–í–û!

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è **M1 MacBook Air 8GB**.

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ**:
```bash
python3 test_speed.py  # –ü—Ä–æ–≤–µ—Ä–∫–∞
python3 app.py         # –°–µ—Ä–≤–µ—Ä
```

**–¢–µ–ø–µ—Ä—å –ë–´–°–¢–†–û, –°–¢–ê–ë–ò–õ–¨–ù–û –∏ –ö–ê–ß–ï–°–¢–í–ï–ù–ù–û!** üöÄüé®
