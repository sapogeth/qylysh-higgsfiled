# ะะพะฝะบััะตะฝัะฝะฐั ะกะธััะตะผะฐ ะะฑััะตะฝะธั LoRA ะดะปั ะะปะดะฐั ะะพัะต

## ะะฟะธัะฐะฝะธะต

ะญัะพ ะฟัะพะดะฒะธะฝััะฐั ัะธััะตะผะฐ ะพะฑััะตะฝะธั LoRA ะผะพะดะตะปะตะน, ะบะพัะพัะฐั ะฐะฒัะพะผะฐัะธัะตัะบะธ ััะฐะฒะฝะธะฒะฐะตั ะบะฐัะตััะฒะพ ะณะตะฝะตัะฐัะธะธ ั ะดััะณะธะผะธ AI ะผะพะดะตะปัะผะธ ะธ ะฟัะตะดะพััะฐะฒะปัะตั ะพะฑัะฐัะฝัั ัะฒัะทั ะดะปั ัะปัััะตะฝะธั.

## ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั

### ะััะธัะตะบัััะฐ ัะธััะตะผั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ะะะะะฃะะะะขะะะ ะะะฃะงะะะะ                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ   1. ะะะะะะ ะะะคะะะะะกะะ (CLIP)       โ
        โ   - ะะทะฒะปะตัะตะฝะธะต ะบะปััะตะฒัั ัะตัั        โ
        โ   - ะะตะฝะตัะฐัะธั ะพะฟัะธะผะฐะปัะฝะพะณะพ ะฟัะพะผะฟัะฐ  โ
        โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
                          โ
                          โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ   2. ะะะะะะะฆะะฏ ะะะะะะะะะะะ          โ
        โ   โ LoRA (ะปะพะบะฐะปัะฝะฐั)                โ
        โ   โ Freepik AI                      โ
        โ   โ DeepAI                          โ
        โ   โ Google Gemini (ะพะฟัะธะพะฝะฐะปัะฝะพ)    โ
        โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
                          โ
                          โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ   3. ะกะะะะะะะะ ะะะงะะกะขะะ             โ
        โ   - CLIP similarity                 โ
        โ   - Feature matching                โ
        โ   - Structural similarity (SSIM)    โ
        โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
                          โ
                          โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ   4. ะะะะะขะะะฏ ะกะะฏะะฌ ะะะฏ LoRA       โ
        โ   - ะะฝะฐะปะธะท ัะปะฐะฑัั ะผะตัั              โ
        โ   - ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ัะปัััะตะฝะธั       โ
        โ   - ะะฒัะพะผะฐัะธัะตัะบะฐั ัะตะธัะตัะฐัะธั       โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะปััะตะฒัะต ะบะพะผะฟะพะฝะตะฝัั

1. **Feature Analyzer** ([feature_analyzer.py](feature_analyzer.py))
   - ะะฝะฐะปะธะทะธััะตั ัะตัะตัะตะฝัะฝัะต ะธะทะพะฑัะฐะถะตะฝะธั ั ะฟะพะผะพััั CLIP
   - ะะทะฒะปะตะบะฐะตั ะบะปััะตะฒัะต ะฒะธะทัะฐะปัะฝัะต ัะฐัะฐะบัะตัะธััะธะบะธ ะฟะตััะพะฝะฐะถะฐ
   - ะะตะฝะตัะธััะตั ะพะฟัะธะผะฐะปัะฝัะต ะฟัะพะผะฟัั ะดะปั ะพะฑััะตะฝะธั

2. **AI Providers Manager** ([ai_providers.py](ai_providers.py))
   - **Deepseek API**: ะะตะฝะตัะฐัะธั ัะฐััะบะฐะทะพะฒ ะธะท ะฟัะพะผะฟัะพะฒ
   - **Freepik AI**: ะะตะฝะตัะฐัะธั ะธะทะพะฑัะฐะถะตะฝะธะน
   - **DeepAI**: ะะปััะตัะฝะฐัะธะฒะฝัะน ะณะตะฝะตัะฐัะพั ะธะทะพะฑัะฐะถะตะฝะธะน
   - **Google Gemini**: ะะฟัะธะพะฝะฐะปัะฝัะน ะฟัะพะฒะฐะนะดะตั

3. **Image Comparator** ([image_comparator.py](image_comparator.py))
   - ะกัะฐะฒะฝะธะฒะฐะตั ะธะทะพะฑัะฐะถะตะฝะธั ะฟะพ ัััะผ ะผะตััะธะบะฐะผ:
     - **CLIP Similarity**: ะกะตะผะฐะฝัะธัะตัะบะพะต ััะพะดััะฒะพ ั ัะตัะตัะตะฝัะฐะผะธ
     - **Feature Matching**: ะกะพะพัะฒะตัััะฒะธะต ะบะปััะตะฒัะผ ัะฐัะฐะบัะตัะธััะธะบะฐะผ
     - **SSIM**: ะกัััะบัััะฝะพะต ััะพะดััะฒะพ
   - ะะฐะฝะถะธััะตั ัะตะทัะปััะฐัั ะฒัะตั AI ะผะพะดะตะปะตะน
   - ะะตะฝะตัะธััะตั ะดะตัะฐะปัะฝัั ะพะฑัะฐัะฝัั ัะฒัะทั

4. **Competitive LoRA Trainer** ([train_lora_competitive.py](train_lora_competitive.py))
   - ะฃะฟัะฐะฒะปัะตั ะฟะพะปะฝัะผ ัะธะบะปะพะผ ะพะฑััะตะฝะธั
   - ะะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะฟััะบะฐะตั ะธัะตัะฐัะธะธ
   - ะกะพััะฐะฝัะตั ะธััะพัะธั ะธ ะฐะฝะฐะปะธัะธะบั

## ะฃััะฐะฝะพะฒะบะฐ

### 1. ะฃััะฐะฝะพะฒะธัะต ะทะฐะฒะธัะธะผะพััะธ

```bash
pip install -r requirements.txt
```

### 2. ะะฐัััะพะนัะต API ะบะปััะธ

ะััะตะดะฐะบัะธััะนัะต ัะฐะนะป `.env`:

```bash
# OpenAI (ะดะปั ะณะตะฝะตัะฐัะธะธ ะฟัะพะผะฟัะพะฒ)
OPENAI_API_KEY=ะฒะฐั_ะบะปัั

# AI Providers ะดะปั ะบะพะฝะบััะตะฝัะฝะพะณะพ ะพะฑััะตะฝะธั
DEEPSEEK_API_KEY=sk-2ce976ae9f1a4c8583b707c236fa6139
FREEPIK_API_KEY=FPSX193caafa0683767de2a873582de96305
DEEPAI_API_KEY=bceb509d99484191608a4c615530003a8c9a8e99cd87bc98b500f293bd19be75
GEMINI_API_KEY=AIzaSyBKZihsdTcixwCcYgiGDK696lUsaJ8cEbs
```

**ะะฐะถะฝะพ**: ะั ัะบะฐะทะฐะปะธ ัะฒะพะธ ะบะปััะธ:
- Deepseek: `sk-2ce976ae9f1a4c8583b707c236fa6139`
- Freepik: `FPSX193caafa0683767de2a873582de96305`
- DeepAI: `bceb509d99484191608a4c615530003a8c9a8e99cd87bc98b500f293bd19be75`
- Gemini: `AIzaSyBKZihsdTcixwCcYgiGDK696lUsaJ8cEbs`

### 3. ะัะพะฒะตัััะต ัะธััะตะผั

```bash
python3 test_competitive_training.py
```

ะญัะพั ัะบัะธะฟั ะฟัะพะฒะตัะธั:
- โ ะัะต ะทะฐะฒะธัะธะผะพััะธ ัััะฐะฝะพะฒะปะตะฝั
- โ ะคะฐะนะปั ะฟัะพะตะบัะฐ ะฝะฐ ะผะตััะต
- โ ะะตัะตัะตะฝัะฝัะต ะธะทะพะฑัะฐะถะตะฝะธั ะฝะฐะนะดะตะฝั
- โ API ะบะปััะธ ะฝะฐัััะพะตะฝั
- โ ะะพะดัะปะธ ัะฐะฑะพัะฐัั ะบะพััะตะบัะฝะพ

## ะัะฟะพะปัะทะพะฒะฐะฝะธะต

### ะัััััะน ััะฐัั

```bash
python3 train_lora_competitive.py
```

ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ:
1. ะัะพะฐะฝะฐะปะธะทะธััะตั ัะตัะตัะตะฝัะฝัะต ะธะทะพะฑัะฐะถะตะฝะธั `aldar1.png` - `aldar5.png`
2. ะกะณะตะฝะตัะธััะตั ะธะทะพะฑัะฐะถะตะฝะธั ัะตัะตะท LoRA ะธ ะบะพะฝะบััะตะฝัะพะฒ
3. ะกัะฐะฒะฝะธั ะบะฐัะตััะฒะพ
4. ะัะตะดะพััะฐะฒะธั ะพะฑัะฐัะฝัั ัะฒัะทั
5. ะะพะฒัะพัะธั ัะธะบะป ะฟัะธ ะฝะตะพะฑัะพะดะธะผะพััะธ (ะดะพ 3 ะธัะตัะฐัะธะน)

### ะขะตััะธัะพะฒะฐะฝะธะต ะพัะดะตะปัะฝัั ะบะพะผะฟะพะฝะตะฝัะพะฒ

#### ะะฝะฐะปะธะท ัะตัะตัะตะฝัะฝัั ะธะทะพะฑัะฐะถะตะฝะธะน

```bash
python3 feature_analyzer.py
```

ะะตะทัะปััะฐั:
- ะะฝะฐะปะธะท ะบะฐะถะดะพะณะพ ัะตัะตัะตะฝัะฐ
- ะะณัะตะณะธัะพะฒะฐะฝะฝัะต ัะฐัะฐะบัะตัะธััะธะบะธ
- ะะฟัะธะผะฐะปัะฝัะน ะฟัะพะผะฟั ะดะปั ะพะฑััะตะฝะธั
- ะกะพััะฐะฝะตะฝะธะต ะฒ `models/aldar_feature_analysis.json`

#### ะขะตััะธัะพะฒะฐะฝะธะต Image Comparator

```bash
python3 image_comparator.py
```

ะัะพะฒะตััะตั ัะธััะตะผั ััะฐะฒะฝะตะฝะธั ะบะฐัะตััะฒะฐ ะฝะฐ ัะตัะตัะตะฝัะฝะพะผ ะธะทะพะฑัะฐะถะตะฝะธะธ.

#### ะขะตััะธัะพะฒะฐะฝะธะต AI Providers

```bash
python3 ai_providers.py
```

ะขะตััะธััะตั:
- ะะตะฝะตัะฐัะธั ัะฐััะบะฐะทะพะฒ ัะตัะตะท Deepseek
- ะะตะฝะตัะฐัะธั ะธะทะพะฑัะฐะถะตะฝะธะน ัะตัะตะท ะฒัะต ะฝะฐัััะพะตะฝะฝัะต ะฟัะพะฒะฐะนะดะตัั

## ะะตะทัะปััะฐัั

ะัะต ัะตะทัะปััะฐัั ัะพััะฐะฝััััั ะฒ ะดะธัะตะบัะพัะธั `lora_training_results/`:

```
lora_training_results/
โโโ comparisons/              # ะกะณะตะฝะตัะธัะพะฒะฐะฝะฝัะต ะธะทะพะฑัะฐะถะตะฝะธั
โ   โโโ lora_20241020_153022.png
โ   โโโ freepik_20241020_153022.png
โ   โโโ deepai_20241020_153022.png
โ   โโโ comparison_report_20241020_153022.json
โโโ feedback/                 # ะะฑัะฐัะฝะฐั ัะฒัะทั ะดะปั LoRA
โ   โโโ feedback_20241020_153022.json
โโโ training_history.json     # ะะพะปะฝะฐั ะธััะพัะธั ะพะฑััะตะฝะธั
```

### ะะฝัะตัะฟัะตัะฐัะธั ัะตะทัะปััะฐัะพะฒ

#### Quality Score (0-1)

ะะฑัะธะน ะฟะพะบะฐะทะฐัะตะปั ะบะฐัะตััะฒะฐ, ัะพััะพััะธะน ะธะท:
- **40%** CLIP Similarity (ัะตะผะฐะฝัะธัะตัะบะพะต ััะพะดััะฒะพ)
- **40%** Feature Matching (ัะพะพัะฒะตัััะฒะธะต ัะฐัะฐะบัะตัะธััะธะบะฐะผ)
- **20%** SSIM (ััััะบัััะฝะพะต ััะพะดััะฒะพ)

**ะัะตะฝะบะฐ:**
- **0.8 - 1.0**: ะัะปะธัะฝะพ! LoRA ะธะดะตะฐะปัะฝะพ ะฒะพัะฟัะพะธะทะฒะพะดะธั ะฟะตััะพะฝะฐะถะฐ
- **0.6 - 0.8**: ะฅะพัะพัะพ, ะฝะตะฑะพะปััะธะต ัะปัััะตะฝะธั ะฒะพะทะผะพะถะฝั
- **0.4 - 0.6**: ะกัะตะดะฝะต, ััะตะฑัะตััั ะดะพัะฐะฑะพัะบะฐ
- **< 0.4**: ะะปะพัะพ, ััะตะฑัะตััั ัะตัััะทะฝะฐั ะดะพัะฐะฑะพัะบะฐ

#### ะัะธะผะตั ะพััะตัะฐ ะพะฑัะฐัะฝะพะน ัะฒัะทะธ

```json
{
  "lora_score": 0.742,
  "best_competitor": "freepik",
  "competitor_score": 0.819,
  "score_gap": 0.077,
  "needs_improvement": true,
  "recommendations": [
    {
      "area": "clip_similarity",
      "message": "ะฃะปัััะธัั ัะตะผะฐะฝัะธัะตัะบะพะต ััะพะดััะฒะพ ั ัะตัะตัะตะฝัะฐะผะธ (ะพัััะฐะฒะฐะฝะธะต: 0.085)",
      "priority": "high"
    },
    {
      "area": "feature_matching",
      "message": "ะฃะปัััะธัั ัะพะพัะฒะตัััะฒะธะต ะบะปััะตะฒัะผ ัะฐัะฐะบัะตัะธััะธะบะฐะผ (ะพัััะฐะฒะฐะฝะธะต: 0.042)",
      "priority": "medium"
    }
  ]
}
```

## ะะพะฝะธะผะฐะฝะธะต ะบะปััะตะฒัั ัะฐะบัะพัะพะฒ

ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฐะฝะฐะปะธะทะธััะตั ัะตัะตัะตะฝัั ะธ ะธะทะฒะปะตะบะฐะตั:

### ะะฐัะตะณะพัะธะธ ัะฐัะฐะบัะตัะธััะธะบ

1. **ะคะพัะผะฐ ะปะธัะฐ**: round face, oval face, square face
2. **ะะปะฐะทะฐ**: narrow eyes, almond-shaped eyes, round eyes
3. **ะฃัั/ะฑะพัะพะดะฐ**: thin mustache, thick mustache, no facial hair
4. **ะัะธัะตัะบะฐ**: topknot, short hair, black hair
5. **ะฆะฒะตั ะพะดะตะถะดั**: orange robe, patterned robe
6. **ะกัะธะปั**: 2D illustration, cartoon style, children's book style
7. **ะััะฐะถะตะฝะธะต**: smiling, friendly, happy
8. **ะคะพะฝ**: steppe landscape, plain background

### ะะฐะบ ัะธััะตะผะฐ ะธัะตั ัะฐัะฐะบัะตัะธััะธะบะธ

ะะปั ะบะฐะถะดะพะณะพ ััะตะนะผะฐ ัะธััะตะผะฐ:

1. **ะะทะฒะปะตะบะฐะตั CLIP embeddings** ะธะทะพะฑัะฐะถะตะฝะธั
2. **ะกัะฐะฒะฝะธะฒะฐะตั ั ัะตะบััะพะฒัะผะธ ะพะฟะธัะฐะฝะธัะผะธ** ะฒัะตั ัะฐัะฐะบัะตัะธััะธะบ
3. **ะััะธัะปัะตั cosine similarity** ะดะปั ะบะฐะถะดะพะน ัะฐัะฐะบัะตัะธััะธะบะธ
4. **ะัะฑะธัะฐะตั ะฝะฐะธะฑะพะปะตะต ะฟะพะดัะพะดััะธะต** (top-2 ะดะปั ะบะฐะถะดะพะน ะบะฐัะตะณะพัะธะธ)
5. **ะะณัะตะณะธััะตั ัะตะทัะปััะฐัั** ะฟะพ ะฒัะตะผ ัะตัะตัะตะฝัะฐะผ
6. **ะคะพัะผะธััะตั ัะธะฝะฐะปัะฝัะน ัะฟะธัะพะบ** ะบะปััะตะฒัั ัะฐัะฐะบัะตัะธััะธะบ

## ะะฐััะธัะตะฝะฝะฐั ะฝะฐัััะพะนะบะฐ

### ะะทะผะตะฝะตะฝะธะต ะบะพะปะธัะตััะฒะฐ ะธัะตัะฐัะธะน

ะ ัะฐะนะปะต `train_lora_competitive.py`:

```python
max_iterations = 3  # ะะทะผะตะฝะธัะต ะฝะฐ ะฝัะถะฝะพะต ะทะฝะฐัะตะฝะธะต
```

### ะะทะผะตะฝะตะฝะธะต ัะตััะพะฒะพะณะพ ะฟัะพะผะฟัะฐ

```python
test_prompt = "ะะฐั ะบะฐััะพะผะฝัะน ะฟัะพะผะฟั ะทะดะตัั"
```

### ะะฐัััะพะนะบะฐ ะฒะตัะพะฒ ะผะตััะธะบ ะบะฐัะตััะฒะฐ

ะ ัะฐะนะปะต `image_comparator.py`, ะผะตัะพะด `compare_with_references`:

```python
quality_score = (
    0.4 * avg_clip_similarity +    # ะะตั CLIP similarity
    0.4 * feature_score +           # ะะตั feature matching
    0.2 * avg_ssim                  # ะะตั SSIM
)
```

## ะะพะดะดะตัะถะบะฐ ัะฐะทะฝัั AI ะฟัะพะฒะฐะนะดะตัะพะฒ

### ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒะพะณะพ ะฟัะพะฒะฐะนะดะตัะฐ

1. ะกะพะทะดะฐะนัะต ะบะปะฐัั ะฒ `ai_providers.py`:

```python
class NewProviderImageGenerator:
    def __init__(self, api_key: str):
        self.api_key = api_key
        self.base_url = "..."

    def generate_image(self, prompt: str) -> Optional[Image.Image]:
        # ะะฐัะฐ ัะตะฐะปะธะทะฐัะธั
        pass
```

2. ะะพะฑะฐะฒััะต ะฒ `AIProvidersManager`:

```python
if config.get('newprovider_api_key'):
    self.providers['newprovider'] = NewProviderImageGenerator(
        config['newprovider_api_key']
    )
```

3. ะะพะฑะฐะฒััะต ะบะปัั ะฒ `.env`:

```
NEWPROVIDER_API_KEY=ะฒะฐั_ะบะปัั
```

## Troubleshooting

### ะัะพะฑะปะตะผะฐ: "LoRA generation failed"

**ะะตัะตะฝะธะต**: ะฃะฑะตะดะธัะตัั, ััะพ:
1. SDXL ะผะพะดะตะปั ะทะฐะณััะถะตะฝะฐ: `python3 setup.py`
2. ะะพััะฐัะพัะฝะพ ะฟะฐะผััะธ (ะผะธะฝะธะผัะผ 8GB RAM ะดะปั M1)
3. MPS ะดะพัััะฟะตะฝ: `import torch; print(torch.backends.mps.is_available())`

### ะัะพะฑะปะตะผะฐ: "No competitors for comparison"

**ะะตัะตะฝะธะต**: ะะฐัััะพะนัะต ัะพัั ะฑั ะพะดะธะฝ ะฒะฝะตัะฝะธะน API ะบะปัั ะฒ `.env`

### ะัะพะฑะปะตะผะฐ: ะะตะดะปะตะฝะฝะฐั ะณะตะฝะตัะฐัะธั

**ะะตัะตะฝะธะต**:
1. ะฃะผะตะฝััะธัะต `NUM_INFERENCE_STEPS` ะฒ `config.py`
2. ะะบะปััะธัะต `USE_LCM = True` ะดะปั ัะปัััะฐ-ะฑััััะพะน ะณะตะฝะตัะฐัะธะธ
3. ะัะฟะพะปัะทัะนัะต Google Colab ะดะปั ััะบะพัะตะฝะธั

### ะัะพะฑะปะตะผะฐ: CLIP ะผะพะดะตะปั ะฝะต ะทะฐะณััะถะฐะตััั

**ะะตัะตะฝะธะต**:
```bash
pip install --upgrade transformers
```

## ะะพะฟัะพัั ะธ ะฟะพะดะดะตัะถะบะฐ

ะัะปะธ ั ะฒะฐั ะฒะพะทะฝะธะบะปะธ ะฒะพะฟัะพัั:

1. ะัะพะฒะตัััะต ะปะพะณะธ ะฒัะฟะพะปะฝะตะฝะธั
2. ะะฐะฟัััะธัะต `test_competitive_training.py`
3. ะัะพะฒะตัััะต ัะฐะนะปั ะฒ `lora_training_results/`

## ะะธัะตะฝะทะธั

ะญัะพั ะฟัะพะตะบั ัะพะทะดะฐะฝ ะดะปั ะพะฑััะตะฝะธั ะธ ะณะตะฝะตัะฐัะธะธ ะธะทะพะฑัะฐะถะตะฝะธะน ะะปะดะฐั ะะพัะต.

---

**ะฃะดะฐัะธ ะฒ ะพะฑััะตะฝะธะธ LoRA!** ๐
