# 📥 PDF Export - Визуальная Новелла/Комикс Стиль

## 🎨 Обзор

Теперь вы можете **скачать весь сториборд в одном PDF-файле** в красивом стиле визуальной новеллы/комикса!

### Особенности:

✅ **Красивое оформление** - Казахская тематика с золотыми и тёплыми тонами
✅ **Титульная страница** - С названием истории и метаданными
✅ **Одна страница = один кадр** - Крупное изображение + текстовое описание
✅ **Декоративные элементы** - Рамки, углы, красивая типографика
✅ **Готово для печати** - Формат A4, профессиональное качество

---

## 🚀 Как Использовать

### 1. Сгенерируйте Сториборд

Используйте веб-интерфейс для создания сториборда:

```
http://localhost:8080
```

### 2. Нажмите Кнопку "Download PDF"

После генерации появятся кнопки:

- **📥 Download PDF (Novel/Comic Style)** - Скачать всё в PDF
- **Download All Images** - Скачать только изображения
- **Create New Story** - Создать новую историю

### 3. Получите PDF

PDF автоматически скачается в папку загрузок:

```
aldar_kose_storyboard_YYYYMMDD_HHMMSS.pdf
```

---

## 📖 Структура PDF

### Титульная Страница (Page 1)

```
┌────────────────────────────────────┐
│                                    │
│        🎭 Алдар Көсе              │
│        ═══════════════             │
│                                    │
│    [Название истории]              │
│                                    │
│    [Текст истории]                 │
│                                    │
│    Frames: 6                       │
│    Generated: 2025-10-19 10:30     │
│                                    │
└────────────────────────────────────┘
```

### Страницы Кадров (Pages 2-N)

Каждый кадр занимает отдельную страницу:

```
┌────────────────────────────────────┐
│         Frame 1 / 6                │
│                                    │
│  ┌──────────────────────────────┐  │
│  │                              │  │
│  │      [ИЗОБРАЖЕНИЕ]           │  │
│  │      (если доступно)         │  │
│  │                              │  │
│  └──────────────────────────────┘  │
│                                    │
│  ┌──────────────────────────────┐  │
│  │ Description: Алдар Көсе...   │  │
│  │                              │  │
│  │ "Dialogue text..."           │  │
│  │                              │  │
│  │ Setting: Steppe | Shot: Full│  │
│  └──────────────────────────────┘  │
│                                    │
│  Алдар Көсе - Page 2              │
└────────────────────────────────────┘
```

---

## 🎨 Дизайн и Стилизация

### Цветовая Палитра (Казахская Тематика)

| Элемент | Цвет | Hex |
|---------|------|-----|
| **Золотой акцент** | Золотой | `#D4AF37` |
| **Темно-коричневый текст** | Тёмный | `#2C1810` |
| **Фон текстовых блоков** | Кремовый | `#FFF8DC` |
| **Рамки** | Золотистый | `#DAA520` |

### Шрифты

- **Заголовки**: Helvetica-Bold (32pt для титула, 14pt для кадров)
- **Описания**: Helvetica (11pt)
- **Диалоги**: Helvetica-Oblique (10pt, курсив)
- **Метаданные**: Helvetica (9-10pt)

### Декоративные Элементы

- ✅ Угловые декорации на каждой странице
- ✅ Горизонтальная линия-разделитель на титульной странице
- ✅ Рамки вокруг изображений
- ✅ Текстовые блоки с фоном и границами
- ✅ Номера страниц в футере

---

## 📂 Технические Детали

### Используемые Технологии

**Backend (Python)**:
- `reportlab` - Генерация PDF
- `PIL (Pillow)` - Обработка изображений

**Frontend (JavaScript)**:
- Fetch API для вызова `/api/export/pdf`
- Автоматическое скачивание файла

### API Endpoint

```http
POST /api/export/pdf
Content-Type: application/json

{
  "storyboard": [
    {
      "frame_number": 1,
      "description": "...",
      "dialogue": "...",
      "setting": "...",
      "shot_type": "...",
      "key_objects": [...],
      "image_path": "static/generated/frame_001_....png"
    },
    ...
  ],
  "metadata": {
    "original_prompt": "...",
    "aldar_story": "...",
    "num_frames": 6,
    "generated_at": "2025-10-19T10:30:00"
  }
}
```

**Response**:
```json
{
  "success": true,
  "pdf_url": "/static/exports/aldar_kose_storyboard_20251019_103000.pdf",
  "filename": "aldar_kose_storyboard_20251019_103000.pdf"
}
```

---

## 🧪 Тестирование

### Автоматический Тест

Запустите тестовый скрипт:

```bash
python3 test_pdf_export.py
```

**Ожидаемый результат**:
```
🧪 PDF EXPORT TEST
======================================================================

📄 Generating test PDF...
✅ PDF generated successfully!
📁 Location: static/exports/test_storyboard.pdf
📊 File size: 6.2 KB

💡 Test Result:
   - Title page with story info ✅
   - 4 frame pages with text boxes ✅
   - Decorative borders and styling ✅
   - Ready for images when available ✅
```

### Ручное Тестирование

1. Запустите сервер: `python3 app.py`
2. Откройте: `http://localhost:8080`
3. Сгенерируйте сториборд
4. Нажмите "Download PDF"
5. Откройте PDF и проверьте:
   - ✅ Титульная страница красиво оформлена
   - ✅ Каждый кадр на отдельной странице
   - ✅ Изображения отображаются (если доступны)
   - ✅ Текст читаемый и хорошо отформатирован
   - ✅ Декоративные элементы на месте

---

## 📊 Формат Макета

### Размеры Страницы (A4)

- **Ширина**: 210mm (595 points)
- **Высота**: 297mm (842 points)
- **Margins**: 1.5cm слева/справа, 2cm сверху/снизу

### Размеры Изображений

- **Максимальная ширина**: Ширина страницы - margins - 2cm
- **Максимальная высота**: 12cm (оставляем место для текста)
- **Пропорции**: Сохраняются автоматически

### Размеры Текстовых Блоков

- **Ширина**: Ширина страницы - margins - 2cm
- **Padding**: 15px внутри блока
- **Border**: 1px золотистый (#DAA520)
- **Background**: Кремовый (#FFF8DC)

---

## 🎯 Примеры Использования

### Пример 1: Полный Сториборд

```python
from pdf_exporter import export_to_pdf

storyboard_data = {
    'storyboard': [
        {
            'frame_number': 1,
            'description': 'Алдар Көсе едет на ослике',
            'dialogue': 'Куда же я направляюсь?',
            'setting': 'Golden steppe',
            'shot_type': 'Full body',
            'key_objects': ['donkey', 'yurts'],
            'image_path': 'static/generated/frame_001.png'
        },
        # ... more frames
    ],
    'metadata': {
        'original_prompt': 'Aldar Köse tricks a khan',
        'aldar_story': 'История о том, как...',
        'num_frames': 6,
        'generated_at': '2025-10-19T10:30:00'
    }
}

pdf_path = export_to_pdf(storyboard_data)
print(f"PDF создан: {pdf_path}")
```

### Пример 2: Только Текст (без изображений)

```python
storyboard_data = {
    'storyboard': [
        {
            'frame_number': 1,
            'description': 'Описание кадра',
            'dialogue': 'Диалог',
            'setting': 'Локация',
            'shot_type': 'Medium shot',
            'key_objects': [],
            'image_path': None  # Изображение отсутствует
        }
    ],
    'metadata': {...}
}

pdf_path = export_to_pdf(storyboard_data, 'my_story.pdf')
```

---

## 🐛 Troubleshooting

### Проблема: "ModuleNotFoundError: No module named 'reportlab'"

**Решение**:
```bash
pip3 install reportlab
# или
python3 -m pip install --user reportlab
```

### Проблема: "PDF generation failed"

**Возможные причины**:

1. **Неправильный путь к изображению**
   - Проверьте, что `image_path` существует
   - Используйте абсолютные пути или относительные от корня проекта

2. **Недостаточно прав на запись**
   - Убедитесь, что папка `static/exports/` существует
   - Проверьте права доступа

3. **Повреждённое изображение**
   - Убедитесь, что изображения валидные PNG/JPG
   - Попробуйте сгенерировать PDF без изображений

**Отладка**:
```python
import traceback

try:
    pdf_path = export_to_pdf(data)
except Exception as e:
    print(f"Error: {e}")
    traceback.print_exc()
```

### Проблема: "Изображения не отображаются в PDF"

**Решение**:

1. Проверьте путь к изображениям:
   ```python
   # Правильно:
   'image_path': 'static/generated/frame_001.png'

   # Неправильно (веб URL):
   'image_path': '/static/generated/frame_001.png'
   ```

2. Убедитесь, что изображения существуют:
   ```bash
   ls -la static/generated/
   ```

---

## 📁 Файлы

### Новые Файлы

- **[pdf_exporter.py](pdf_exporter.py)** - Класс для экспорта PDF
- **[test_pdf_export.py](test_pdf_export.py)** - Тестовый скрипт

### Изменённые Файлы

- **[app.py](app.py)** - Добавлен endpoint `/api/export/pdf`
- **[templates/index.html](templates/index.html)** - Добавлена кнопка "Download PDF"
- **[static/js/app.js](static/js/app.js)** - Добавлена функция `downloadPDF()`
- **[static/css/style.css](static/css/style.css)** - Стили для кнопки PDF
- **[requirements.txt](requirements.txt)** - Добавлен `reportlab>=4.0.0`

---

## 🎉 Итоги

### ✅ Реализовано:

1. **PDF-генератор** - Красивый класс `StoryboardPDFExporter`
2. **Визуальная новелла стиль** - Большие изображения + текст
3. **Казахская тематика** - Золотые тона, традиционное оформление
4. **Декоративные элементы** - Рамки, углы, разделители
5. **API endpoint** - `/api/export/pdf` для веб-интерфейса
6. **Кнопка скачивания** - Большая красивая кнопка в UI
7. **Автоматическое скачивание** - Один клик = готовый PDF

### 📊 Характеристики:

| Функция | Статус |
|---------|--------|
| **Титульная страница** | ✅ |
| **Кадры с изображениями** | ✅ |
| **Текстовые описания** | ✅ |
| **Диалоги** | ✅ |
| **Декоративные элементы** | ✅ |
| **Казахская тематика** | ✅ |
| **Формат A4** | ✅ |
| **Автоматическое скачивание** | ✅ |

---

## 🚀 Использование

### Быстрый Старт:

```bash
# 1. Установите зависимости
pip3 install reportlab

# 2. Запустите сервер
python3 app.py

# 3. Откройте браузер
# http://localhost:8080

# 4. Сгенерируйте сториборд

# 5. Нажмите "Download PDF (Novel/Comic Style)"

# 6. Наслаждайтесь! 🎉
```

---

## 💡 Будущие Улучшения (Опционально)

- 📄 **Разные макеты** - Grid layout для нескольких кадров на странице
- 🎨 **Темы оформления** - Светлая/тёмная/классическая
- 📖 **Оглавление** - Для длинных историй
- 🔤 **Поддержка шрифтов** - Казахские/кириллические шрифты
- 📱 **Адаптивные размеры** - Letter, A5 и т.д.
- 🖼️ **Watermark** - Логотип Алдар Көсе
- 📊 **Статистика** - Количество кадров, слов, диалогов

---

## 📞 Поддержка

При возникновении проблем:

1. Проверьте [Troubleshooting](#-troubleshooting)
2. Запустите тестовый скрипт: `python3 test_pdf_export.py`
3. Проверьте логи сервера
4. Убедитесь, что `reportlab` установлен

---

**Готово! Теперь вы можете создавать красивые PDF-сториборды в стиле визуальной новеллы/комикса!** 📥🎨✨
